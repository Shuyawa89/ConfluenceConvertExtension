# ADR 001: プロジェクト概要と初期技術選定

## ステータス
承認済み (Accepted)

## コンテキスト
現在開いているConfluenceの単一ページを、Markdown形式 (`.md`) に変換して保存するChrome拡張機能を開発したい。
開発者は拡張機能開発の経験がなく、学習も兼ねてモダンかつデファクトスタンダードな技術選定を行いたい。
当初はAPIキーの利用も検討したが、ユーザーの利便性を考慮し、DOM解析による実装を選択した。

## 要件定義

### 機能要件
1.  **対象**: 現在アクティブなタブ（Confluenceページ）。
2.  **トリガー & UIフロー**:
    *   拡張機能アイコンをクリックするとポップアップが表示される。
    *   ポップアップ内に、現在のページ内容がMarkdownに変換されてプレビュー表示される。
    *   「保存」ボタンを押すと、ファイルとしてダウンロードされる。
3.  **変換ロジック**:
    *   **DOM解析**: 現在描画されているDOM（メインコンテンツ）を取得して解析する。APIは使用しない。
    *   **画像**: 現時点では `src` 属性（URL）をそのまま維持する。ただし、将来的な変更（Base64化など）に備え、処理メソッドは分離しておく。
    *   **テーブル**: 標準的なMarkdownテーブルとして変換する。
    *   **その他要素**: 特有のマクロなどは一旦無視し、ライブラリの標準挙動に任せる。
4.  **ファイル保存**:
    *   ファイル名: ページタイトルを使用。OSで使用できない文字はサニタイズする。

## 技術選定と意思決定

### 1. コア技術
*   **Manifest V3**
    *   **理由**: Chrome拡張機能の現在の標準規格であり、セキュリティとパフォーマンスが向上しているため。

### 2. 開発言語
*   **TypeScript**
    *   **理由**: 型安全性によるバグの抑制と、コードの可読性・保守性向上のため。ユーザー定義ルールでも推奨されている。

### 3. ビルドツール & 開発環境
*   **Vite + CRXJS Vite Plugin**
    *   **理由**: 高速なビルドとHMR（ホットリロード）による優れた開発体験（DX）を提供するため。拡張機能開発におけるモダンなスタンダード構成。

### 4. UIフレームワーク
*   **React**
    *   **理由**: UIライブラリのデファクトスタンダード。状態管理（プレビュー表示など）が容易であり、学習資料も豊富であるため。

### 5. 変換ライブラリ
*   **Turndown** (+ `turndown-plugin-gfm`)
    *   **理由**: HTML to Markdown変換のデファクトスタンダード。プラグインによりGitHub Flavored Markdown（テーブルなど）に対応可能。

## 今後の拡張性に関する考慮
*   **画像処理**: `extractImageSrc` のような独立したメソッドに切り出し、将来的に認証付き画像の取得やBase64埋め込みに対応できるようにする。
